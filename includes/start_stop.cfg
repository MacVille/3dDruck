############################################################
# START_PRINT T_EXTRUDER = 0 T_BED = 0
############################################################
[gcode_macro START_PRINT]
gcode:
  #Definieren von Parameter für Slicer
  {% set t_extruder = params.T_EXTRUDER|default(0)|float%}
  {% set t_bed = params.T_BED|default(0)|float%}

  #Alle Achsen auf 0
  #SET_HEATER_TEMPERATURE HEATER=extruder TARGET={t_extruder}
  #SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={t_bed}
  M104 S{t_extruder}            ; Setzen von Hotend Temperatur
  M140 S{t_bed}                 ; Setzen von Bed Temperatur
  M221 S200                     ; Setzen vom Flow

  G92 E0                        ; Extruder zurücksetzen
  
  G28 X0 Y0                     ; X/Y auf 0 Setzten auf Endstop
  G28 Z0                        ; Z auf 0 Setzen auf Endstop
  #M83                           ; Extruder relative Position

  G1 X112.5 Y110 F2000          ; Hotend in die Mitte des Bettes bewegen
  G92 E0.0                      ; Extruder zurücksetzen

  G90                           ; Absolute Position

  ### Mesh Laden
  #BED_MESH_PROFILE LOAD=default

  #TEMPERATURE_WAIT SENSOR=extruder MAXIMUM={t_extruder}
  #TEMPERATURE_WAIT SENSOR=heater_bed MAXIMUM={t_bed}
  M190 S{t_bed}                 ; Warten auf Bed Temperatur
  M109 S{t_extruder}            ; Warten auf Hotend Temperatur

  ### Purge Line
  _PURGE_LINE

[gcode_macro END_PRINT]
gcode:
  {% set X = params.X|default(0)|float%}
  {% set Y = params.Y|default(200)|float%}
  {% set Z = params.Z|default(10)|float%}
  {% set E = params.E|default(0)|float%}


  TURN_OFF_HEATERS
  M117 Heater aus
  G91                                        ; relative positioning
  G1 E-5 F300                                ; retract a little
  G1 Z+{Z}                                    ; lift print head
  G90
  G1 X{X} Y{Y}			         ;Move the print to max y pos for part rermoval
  G1 Y180 F2000                              ; reset feedrate
  G90                                        ; absolute positioning
  M84                                        ; disable stepper motors
  M117 Druck ist fertig

  UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30
  
[gcode_macro _PURGE_LINE]
gcode:
  G28 ;Home
  G92 E0 ;Reset Extruder
  G1 Z2.0 F3000 ;Move Z Axis up
  G1 X5.1 Y20 Z0.28 F5000.0 ;Move to start position
  G1 X5.1 Y200.0 Z0.28 F1500.0 E15 ;Draw the first line
  G1 X5.4 Y200.0 Z0.28 F5000.0 ;Move to side a little
  G1 X5.4 Y20 Z0.28 F1500.0 E30 ;Draw the second line
  G92 E0 ;Reset Extruder
  G1 E4 F300 ; Extrude 4mm of Filament
  G1 Z2.0 F3000 ;Move Z Axis up

 #G0 Z0.15                                   ; lift nozzle a bit
 #G0 X2                                      ; move away from clips
 #G92 E0                                     ; zero the extruded length
 #G1 Y50 E25 F500                            ; Extrude 25mm of filament in a 5cm line.
 #G92 E0                                     ; zero the extruded length again
 #G1 E-2 F500                                ; Retract a little
 #G1 Y120 F4000                              ; Quickly wipe away from the filament line



